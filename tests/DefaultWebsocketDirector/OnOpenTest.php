<?php

namespace JamesClark32\Websocket\Tests\DefaultWebsocketDirector;

use JamesClark32\Websocket\DefaultWebsocketDirector;
use PHPUnit\Framework\TestCase;
use Ratchet\ConnectionInterface;

class OnOpenTest extends TestCase
{
    /** @test */
    public function onOpen_adds_user_to_clients_array()
    {
        $connection = new OnOpenConnection();
        $director = new DefaultWebsocketDirector();

        $director->onOpen($connection);

        $this->assertArrayHasKey($connection->resourceId, $director->getClients());
        $this->assertInstanceOf(OnOpenConnection::class, $director->getClients()[$connection->resourceId]);
    }
}

class OnOpenConnection implements ConnectionInterface
{
    public int $resourceId;

    public function __construct()
    {
        $this->resourceId = rand(1, 9999);
    }

    public function send($data)
    {
        //
    }

    public function close()
    {
        //
    }
}
